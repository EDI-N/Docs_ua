###############################################################################################################
Інструкція розробника. Первинні налаштування
###############################################################################################################

.. role:: underline

.. role:: red

.. contents:: Зміст:
   :depth: 4

---------

Скорочення:

е-ТТН – товарно-транспортна накладна в електронній формі

ОС - облікова система

ЕЦП - електронно-цифровий підпис/печатка

GLN - (Global Location Number) глобальний номер місцезнаходження

НКІ - носій конфіденційної інформації

---------

****************************************************
**1 Перший запуск і налаштування модуля**
****************************************************

Розроблений компанією EDIN інтеграційний модуль сервісу EDIN "ETTN" (в подальшому просто модуль) дозволяє працювати з обліковими системами 1С | BAS: Підприємство 8.Х :underline:`на звичайних та керованих формах`, платформа 8.3.11 та вище (надалі 1С | BAS) на базі операційної системи Windows, та орієнтований на вантажовідправника.

Для роботи з модулем у користувача повинна бути підключена послуга для роботи з API. Для роботи з модулем користувачеві надаються логін та пароль:

- **email** - логін користувача;
- **password** - пароль користувача на платформі EDIN 2.0.

Для запуску модуля необхідно в обліковій системі 1С | BAS відкрити файл запуску модуля (передається користувачеві співробітниками EDIN):

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_001.png
   :align: center

.. important:: У користувача повинні бути повні права на каталог, в якому знаходиться файл модуля

При підключенні модуля облікова система 1С | BAS може вимагати від користувача дозвіл на виконання операцій з боку модуля (захист від небезпечних дій).

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_002.png
   :align: center

При першому запуску (відсутній **config.txt**) автоматично відкривається розділ **"Налаштування"** для введення всіх необхідних даних (надалі при запуску відкривається розділ **"Вхідні"**). У каталозі, в якому розташований файл модуля, автоматично створюються файл основних налаштувань **Config.txt**.

********************************
**2 Налаштування**
********************************

При першому запуску інтеграційного модуля сервісу EDIN "ETTN" автоматично відкривається розділ **"Налаштування"**:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_003.png
   :align: center 

Розділ містить 4 вкладки:

- **Підключення**
- **Об'єкти ОС**
- **Користувач**
- **ЕЦП**

**2.1 Підключення**
================================================

**Основний каталог** – місце розташування файлу модуля.

**Каталог архівів** – місце збереження архівів та файлів.

**Каталог вкладень** – місце збереження вкладень документів.

**Сервер обміну** – адреса платформи електронного документообігу (на цю адресу надсилаються запити модуля).

**Зберігати логи** – при встановленій відмітці зберігається логи.

**Каталог логів запитів з помилками** – місце збереження запитів з помилками.

У цій вкладці додаються (зелена кругла кнопка "+") користувачі, для кожного вказуються свої **Логін користувача API/ Пароль користувача API (збігаються з даними для входу на платформу)**. У цій вкладці також здійснюється вибір користувачів, від імені яких будуть здійснюватися подальші дії, наприклад, запити на відображення Вхідних / Вихідних документів.  

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_004.png
   :align: center

.. note::
   Налаштування користувачів зберігаються в файлі **UserSettings**, який розміщується в підкаталозі (найменування = <користувач 1С | BAS>) на одному рівні з файлом запуску модуля.

Після того, як дані користувачів були введені можливо здійснити перевірку (кнопка **"Перевірити підключення користувачів"**) введених даних (по користувачам, у рядках яких встановлено відмітки в колонці "Вибрати"). В результаті перевірки отриманий **Токен** свідчить про коректно заповнені дані, пройдену авторизацію на платформі електронного документообігу. Також модуль відображає статусні повідомлення про успішність чи помилки, що можуть виникнути у користувача при роботі з модулем.

**2.2 Об'єкти ОС**
================================================

Для подальшої роботи з електронним документообігом необхідно провести синхронізацію модуля і ОС. Для виконання первинних налаштувань необхідно натиснути кнопку **«Заповнити за замовчуванням»**. Дані налаштування можливо відкоригувати у подальшому за необхідності.

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_005.png
   :align: center

За допомогою кнопки **«Контрагенти»** та пошуку необхідно додати контрагентів з якими планується обмін у сервісі ETTN:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_006.png
   :align: center

Потім необхідно встановити співвідношення довідників EDI з даними в 1С. Для прикладу: у довіднику «Організації» необхідно вказати вашу організацію в 1С (інші довідники заповнюються за необхідності аналогічним чином): 

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_007.png
   :align: center

З випадаючого списку обрати необхідну організацію:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_008.png
   :align: center

Наступним кроком  необхідно додати та обрати електронні документи сервісу EDIN «ETTN», якими буде здійснюватись в подальшому електронний документообіг (колонка «Документ»):

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_009.png
   :align: center

Далі потрібно для кожного електроного документу обрати документ облікової системи (на підставі цього документа можливо буде створювати електронний документообіг) - колонка «Документ ОС»:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_010.png
   :align: center

В колонках **ID документа**, **ID заявки на транспортування**, **Hash заявки на транспортування**, **ID акта приймання-передачі** вказуються налаштування місцерозташування **uuid та hash**, які записуються у вказане поле системою автоматично. Обов’язкові для заповнення тільки налаштування тих документів, які будуть використовуватися в роботі.

Приклад заповнення **ID документа**:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_011.png
   :align: center

А в колонці «Сторона документообігу» обирається роль учасника документообігу, що дозволяє для кожної ролі вказувати різні налаштування для документів.

В колонці "EDIN Налаштування документу" вказуються загальні налаштування документів (маппінг для формування електронного документу з даних документів ОС). Для того аби відкрити форму налаштувань потрібно натиснути на кнопку **"..."**:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_012.png
   :align: center

Відкрита форма налаштувань відповідності даних документа містить специфікацію тіла обраного електронного документа а також його табличної частини:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_013.png
   :align: center

Для кожного із представлених тегів (полей) специфікації документу можливо обрати реквізити для заповнення: для цього потрібно обрати потрібний тег та в колонці "Опис налаштування" натиснути на кнопку **"..."**:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_014.png
   :align: center

Після чого відкриється форма налаштувань відповідності даних електронного документу, в якій можливо обрати реквізит документа ОС для заповнення обраного тега електронного документу (кнопка **"..."**):

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_015.png
   :align: center

На формі в обраному реквізиті (умовно "1") можливо обрати підлеглий до нього інший реквізит (умовно "1.1"). Цю операцію вибору підлеглого реквізиту, що відноситься до вже обраного можливо продовжити ("1.1"->"1.1.1"->"1.1.1.6"->"1.1.1.6.4"->"1.1.1.6.4.2" ...) за допомогою кнопки:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_016.png
   :align: center

Після вибору реквізиту стане доступним для редагування "Спосіб пошуку значення":

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_017.png
   :align: center

"Спосіб пошуку значення" = "По значенню" свідчить, що для заповнення тегу електронного документа буде обрано значення реквізиту документу ОС. І для даного значення реквізиту, що наведений на зображенні вище не доступні "Додаткові властивості ОС". "Спосіб пошуку значень" = "Додаткові властивості ОС", які використовуються, коли потрібно обрати значення, що не зберігаються безпосередньо в об'єкті 1С | BAS. Після чого можливо обрати назву додаткової відомості:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_018.png
   :align: center

В формі налаштувань відповідності даних документа в специфікації тіла обраного електронного документа окрім типових тегів містяться й нетипові (додаткові), які відрізняються тим, що дозволяють налаштувати, наприклад, математичні операції та їх використання для автоматичного заповнення тегів електронного документа:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_019.png
   :align: center

**2.3 Користувач**
=====================

В даному розділі виконується налаштуванння сервісів для використання. Для того, щоб ввімкнути частину модулю для роботи з документами EDI+ЮЗД сервісу необхідно відмітити чекером відповідний реквізит:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_020.png
   :align: center

Після цього в модулі активується вкладка для роботи з сервісом EDI+ЮЗД:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_021.png
   :align: center

**2.4 ЕЦП**
=====================

Розділ налаштувань електронно-цифрового підпису і печатки (ЕЦП).

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_022.png
   :align: center

У таблицю через кнопку **"+"** можливо додати або шляхи до ключів підписанта, якими будуть підписуватись юридично значимі документи або вказати токен (НКІ). Якщо вказано шлях до файлу (ключа) і токену, то пріоритет надається файлу. Налаштування для токену ("Тип пристрою" та "Пристрій" (серійний номер часто вказується на фізичному носії)) можливо вибрати зі списку або скористатись автоматичним підбором налаштувань.

При вивантаженні юридично значимих документів паролі можна вносити або до таблиці, або обробка відобразить вікно для їх внесення перед початком підписання. Кнопка **"Перевірити ЕЦП"** дозволяє перевірити коректність введених даних ключів і паролів перед початком підписання. 

Модуль дозволяє зберігати будь-яку кількість наборів ключів, але на момент підписання по одній організації і типу документу необхідно вибрати (встановити прапорець в колонці "Вибрати") тільки одну пару ключів.

При виявленні помилки при перевірці модуль попросить повторно ввести пароль:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_023.png
   :align: center

При кожній перевірці ключа у вікні повідомлень відображається опис результату виконаної перевірки:

.. image:: pics_prog_1C_eTTN_3_0_integration/prog_1C_eTTN_3_0_integration_024.png
   :align: center

-------------------------------------

.. include:: /_constant/kontakti.rst
