Інтеграція
###########

**Стандартний процес підключення**
===================================

Від Вас має надійти запит (до Вашого менеджера EDIN, якщо Ви вже наш клієнт) про бажання налаштування інтеграції з платформою EDIN / конкретним сервісом / окремим типом документів.

Для Інтеграції Вам доступні наступні варіанти підключення: 

.. toctree::
   :maxdepth: 1
   
   APIv2/APIv2_list
   AS2
   SOAP
   FTP
   1C_integration_2_0/1C_integration_2_0_list
   Podpisanie/E_Sign
   Podpisanie/CryptoLibraries

**Підключення обміну через FTP**
------------------------------------------------------

Менеджер EDIN формує запит на технічну підтримку (для ввімкнення FTP, створення користувачів/GLN і т.п.). Увімкнувши для користувача (за Логіном) доступ до FTP на пошту закріплену за Логіном автоматично надсилаються дані доступу до FTP сервера. Менеджер або спеціаліст технічної підтримки надає користувачу (Вам) опис та специфікації до бажаних документів (посилання на wiki і тд.). Менеджер формує запит на відділ Інтеграції для консультації з налаштуванню та реалізації вивантаження документів (за потреби). Також менеджер може продати інтеграційний модуль і в такому випадку потрібна задача на налаштування модуля з обліковою системою клієнта. Отримавши доступ та виконавши налаштування Вашої облікової системи Ви зможете вивантажувати документи в XML форматі в каталог Outbox. Вхідні для Вас документи будуть надходити в каталог Inbox. Ви також можете вивантажувати документи з конкретною назвою файлу (`детальніше про формат <https://wiki.edin.ua/uk/latest/integration_2_0/FTP.html>`__).

**Підключення обміну через AS2**
------------------------------------------------------

Менеджер EDIN формує запит на відділ Інтеграції для налаштування з Вами каналу зв'язку (попередньо Ви маєте має надати параметри з'єднання). Відділ Інтеграції сумісно з адміністраторами системи налаштовують з'єднання, каталоги, скрипти обробки. Менеджер формує запит на відділ Інтеграції для консультації з налаштування та реалізації вивантаження документів (за потреби). Після успішного налаштування каналу зв'язку, виконавши налаштування облікової системи Ви зможете вивантажувати документи в XML форматі в каталог Outbox. Вхідні для Вас документи будуть надходити в каталог Inbox. Ви також можете вивантажувати документи з конкретною назвою файлу (`детальніше про формат <https://wiki.edin.ua/uk/latest/integration_2_0/FTP.html>`__).

**Підключення обміну через API**
------------------------------------------------------

Для початку роботи по API Ви маєте зареєструватись (повинні мати Логін та пароль). Менеджер або спеціаліст технічної підтримки надасть інформацію про методи роботи з API та посилання на опис специфікації з документами (посилання на Wiki і тд.). Менеджер формує запит на відділ Інтеграції для консультації з налаштування та реалізації вивантаження документа (за потреби). Також менеджер може продати інтеграційний модуль і в такому випадку потрібна задача на налаштування модуля з обліковою системою клієнта. Для роботи по API достатньо мати логін / пароль та коректно формувати запити по роботі з документами (згідно опису на wiki).

**Додаткові можливості та налаштування**
------------------------------------------------------

**Конвертація формату документів**
`````````````````````````````````````````````````````````````````

Функціонал дозволяє конвертувати отриманий у вигляді файлу набір даних в документ, що матиме структуру, яка буде відповідати вимогам документообігу. Конвертація дозволяє реалізовувати додаткові логіки (автоматичну заміну, сортування даних, тощо). Виконання перевірок наповнення контенту документа, додавання умов та правил згідно з Вашими вимогами до формату документа (ми обговорюємо з Вами). Менеджер EDIN формує запит для відділу Інтеграції для розробки карти конвертації, налаштування конвертації. З Вами погоджуються правила та умови конвертації, Ви надаєте приклади документів, що потребують конвертації; ми узгоджуємо Логін користувача платформи, на якому буде відбуватись обмін документами з конвертацією. Також для узгодженого Логіну вмикається параметр "Спец XML". За налаштованої конвертації Ваші документи розміщаються в каталозі Coutbox, а Вхідні документи Ви отримуєте з каталогу Cinbox. У випадку налаштування конвертації "бажано" (але не обов'язково) від Вас отримувати файли з встановленим іменем (це дозволить спростити реалізацію). `Детальніше про формат <https://wiki.edin.ua/uk/latest/integration_2_0/FTP.html>`__. Для ТТН документів на виході після конвертації ім'я документа буде мати наступний формат: ``ettn_глн_відправника_тут_що_захоче_клієнт.xml``

**Автоматичне доповнення тіла документа для ТТНv3**
`````````````````````````````````````````````````````````````````

Доповнення даними відбувається з довідників платформи EDIN.

**Для API:**

Для методу що використовується для `створення ТТН документа <https://wiki.edin.ua/uk/latest/API_ETTNv3_1/Methods/CreateEcmrEttn.html>`__ додано опційний параметр **"fill_up"** (за замовчуванням = false - тіло ТТН не доповнюємо). Якщо вказати **fill_up = true**, то виконується перевірка тіла ТТН на наповненість та послідовне автоматичне доповненя його даними (по Компанії, Водію, Транспорту, Пунктам Навантаження/Розвантаження) з довідників платформи, автоматичний розрахунок Загальної ваги;

**Для FTP/AS2:**

За замовчуванням виконується логіка автоматичного доповнення тіла ТТН-документа (fill_up = true).
Щоб документ був успішно опрацьований, його ім’я повинно мати формат: ``ettn_глн_відправника_тут_що_захоче_клієнт.xml``
Якщо **fill_up=true**, система автоматично підтягує відсутні дані з GLN-довідників системи EDIN, не змінюючи вже передані користувачем значення.
Доповнення виконується для основних блоків документа: Вантажовідправник, Вантажоодержувач, Замовник, Водій, Автомобіль, Причіп/напівпричіп, Пункти навантаження та розвантаження.
Для кожного з них достатньо вказати ідентифікатор (GLN, ІПН або реєстраційний номер). Решта реквізитів — назва, адреса, контакти, технічні характеристики, дані водія чи транспортного засобу — автоматично доповнюються із системи EDIN.
Якщо відповідний GLN або інший ідентифікатор не знайдено у довідниках, система залишає лише передані користувачем дані без змін.

**Повна та Часткова перевірка тіла документа**
`````````````````````````````````````````````````````````````````

**(для користувачів, які не мають можливості на момент вивантаження документа передавати його повноцінно в наповненому вигляді)**

**Для API:**

Для методу що використовується для `створення ТТН документа <https://wiki.edin.ua/uk/latest/API_ETTNv3_1/Methods/CreateEcmrEttn.html>`__ додано опційний параметр **"full_validate"** (за замовчуванням = true):

* Якщо **full_validate = false** - то у відповіді повертається помилка лише за полями, які необхідні для збереження документа;
* Якщо **full_validate = true** - то у відповіді повертається помилка за всіма обов’язковими полями та xsd валідацією.
* Незалежно від параметра **full_validate** документ проходить повну перевірку (всі обов’язкові поля та XSD), якщо ця перевірка успішна — то в **extrafield** проставляється **ready_for_sign** параметр.

**Для FTP/AS2:**

Для того, аби була застосована умова **full_validate**, в імені файлу має бути зазначено параметр **"unvalidate"**, наприклад: ``ettn_4820052660009_unvalidate_5000977617_202311241527153220200_000009jFm.xml``


