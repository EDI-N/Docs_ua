########################################################################################################################
Документообіг з мережею "Укрнафта" на платформі EDI Network 2.0. Інструкція Постачальника
########################################################################################################################

.. дууууже схожа інструкція в Бокс маркета

.. сюда закину немного картинок для текста

.. |лупа| image:: pics_UkrNafta_Standard/UkrNafta_Standard_003.png

.. |будинок| image:: pics_UkrNafta_Standard/UkrNafta_Standard_004.png

.. role:: red

.. contents:: Зміст:
   :depth: 2

---------

Вступ
====================================

Дана інструкція описує порядок документообігу з мережею "Укрнафта" на платформі EDI Network 2.0. В документообігу приймають участь наступні документи:

- `Замовлення (ORDER) <https://wiki.edin.ua/uk/latest/EDIN_Specs/XML/ORDER_x.html>`__
- `Підтвердження замовлення (ORDRSP) <https://wiki.edin.ua/uk/latest/ClientProcesses/UkrNafta/UkrNafta_XML-structure.html#ordrsp>`__
- `Повідомлення про відвантаження (DESADV) <https://wiki.edin.ua/uk/latest/ClientProcesses/UkrNafta/UkrNafta_XML-structure.html#desadv>`__
- `Повідомлення про прийом (RECADV) <https://wiki.edin.ua/uk/latest/EDIN_Specs/XML/RECADV_x.html>`__
- `Видаткова накладна (DOCUMENTINVOICE) <https://wiki.edin.ua/uk/latest/ClientProcesses/UkrNafta/UkrNafta_XML-structure.html#documentinvoice>`__
- при необхідності також `Акт невідповідності (COMDOC_009) <https://wiki.edin.ua/uk/latest/EDIN_Specs/XML/COMDOC_009_x.html>`__

**Загальна схема документообігу:**

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_001.png
   :height: 700px
   :align: center

1 Формування "Підтвердження замовлення" (ORDRSP) у відповідь на вхідне "Замовлення" (ORDER)
=========================================================================================================================

Мережа "Укрнафта" формує і відправляє "Замовлення" (ORDER). Для формування "Підтвердження замовлення" (ORDRSP) потрібно у папці **"Вхідні"** обрати "Замовлення" (ORDER), за яким потрібно зробити підтвердження (для зручності можливо скористатись `пошуком <https://wiki.edin.ua/uk/latest/general_2_0/rabota_s_platformoj_EDIN_2.0.html#doc-search>`__):

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_005.png
   :align: center

Для формування "Підтвердження замовлення" (ORDRSP) натисніть **"Створити документ"** в блоці `ланцюжка документів <https://wiki.edin.ua/uk/latest/_constant/chain/chain.html>`__ для мережі "Укрнафта" - документ створиться автоматично.

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_006.png
   :align: center

У відкритій формі "Підтвердження замовлення" (ORDRSP) всі обов'язкові до заповнення поля (позначені червоною зірочкою :red:`*`) заповнюються автоматично з пов'язаного "Замовлення":

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_007.png
   :align: center

#. **Одержувач** - дані одержувача (мережі), не підлягають редагуванню
#. **№** - номер підтвердження замовлення;
#. **від** - дата підтвердження замовлення, за замовчуванням вказана поточна дата;
#. **Покупець** - заповнюється автоматично, не підлягає редагуванню;
#. **Постачальник** - заповнюється автоматично, не підлягає редагуванню;
#. **Місце доставки** - заповнюється автоматично, не підлягає редагуванню.

В блоці **Разом** вказується загальна кількість табличних позицій.

В табличній частині відображається основна інформація по замовлених **товарних позиціях**. **Товарні позиції** переносяться з "Замовлення" (ORDER): їх можна **"+Додати"**, змінити, підтвердити/відхилити чи **"Видалити"**.

:red:`Всі зміни за позиціями варто виконувати тільки після узгодження з мережею!`

Зміни за позиціями можливо виконувати в табличній частині в колонках "Ціна без ПДВ", "Підтверджена кількість" або за конкретною позицією, натиснувши на штрихкод позиції:

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_008.png
   :align: center

Якщо по якійсь з позицій не буде поставки її необхідно відзначити галочкою і **"Видалити"**.

.. attention::
   Підтверджена кількість товарних позицій не може перевищувати зазначену в "Замовленні" (ORDER)!

Після внесення всіх даних в документ, натисніть кнопку **"Зберегти"** (1), потім **"Відправити"** (2).

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_009.png
   :align: center

Відправлений документ автоматично потрапляє в папку **"Надіслані"** і буде знаходиться в `ланцюжку документів <https://wiki.edin.ua/uk/latest/_constant/chain/chain.html>`__ разом із "Замовленням" (ORDER).

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_010.png
   :align: center

2 Формування "Повідомлення про відвантаження" (DESADV)
=========================================================================================================================

Створити "Повідомлення про відвантаження" (DESADV) можливо одразу на підставі вхідного "Замовлення" (ORDER) або відправленого "Підтвердження замовлення" (ORDRSP). Для створення відвантаження за вже підтвердженими позиціями потрібно у папці **"Надіслані"** обрати "Підтвердження замовлення" (ORDRSP), за яким потрібно зробити відвантаження (для зручності можливо скористатись `пошуком <https://wiki.edin.ua/uk/latest/general_2_0/rabota_s_platformoj_EDIN_2.0.html#doc-search>`__):

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_011.png
   :align: center

Для формування "Повідомлення про відвантаження" (DESADV) натисніть **"Створити документ"** в блоці `ланцюжка документів <https://wiki.edin.ua/uk/latest/_constant/chain/chain.html>`__ для мережі "Укрнафта" - документ створиться автоматично.

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_012.png
   :align: center

У відкритій формі "Повідомлення про відвантаження" (DESADV) деякі поля заповнюються автоматично з пов'язаного документа-підстави (обов'язкові до заповнення поля позначені червоною зірочкою :red:`*`):

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_013.png
   :align: center

#. **Одержувач** - дані одержувача (мережі); заповнюється автоматично, можливо змінити за допомогою кнопки "Пошук контрагента" (|лупа|);
#. **Повідомлення про відвантаження №** - номер "Повідомлення про відвантаження";
#. **від** - дата "Повідомлення про відвантаження", за замовчуванням вказана поточна дата;
#. **Доставка буде проведена** - дата і час доставки;
#. **Постачальник** - заповнюється автоматично або за допомогою кнопки "Пошук контрагента" (|лупа|), або за допомогою кнопки "Вказати себе" (|будинок|);
#. **Покупець** - заповнюється автоматично або за допомогою кнопки "Пошук контрагента" (|лупа|), або за допомогою кнопки "Вказати себе" (|будинок|);
#. **Місце доставки** - заповнюється автоматично або за допомогою кнопки "Пошук контрагента" (|лупа|), або за допомогою кнопки "Вказати себе" (|будинок|);
#. **Повідомлення на замовлення №** - номер "Замовлення" в ланцюжку документів (поле не доступне до редагування);
#. **За накладною №** / **від** - номер та дата накладної. :red:`Номер "первинного" документа на паперовому носії повинен співпадати з номером накладної!`

.. important::
   **Увага!** Номер вказаної накладної повинен повністю збігатися з номером оригіналу паперової накладної.

.. hint::
   За допомогою кнопки **"Пошук контрагента"** (|лупа|) або ж за допомогою кнопки **"Вказати себе"** (|будинок|) можливо вказати чи змінити дані Покупця або Постачальника. Для пошуку введіть назву компанії, GLN або ІПН:

   .. image:: pics_UkrNafta_Standard/UkrNafta_Standard_002.png
      :align: center

Блоки **Додаткова інформація** та **Транспортування** необов'язкові для заповнення і "згорнуті" за замовчуванням. Блок **Разом** розраховується автоматично після заповнення позицій.

   .. image:: pics_UkrNafta_Standard/UkrNafta_Standard_014.png
      :align: center

Перелік товарних позицій (які були замовлені), їх кількість, що постачається повинні збігатись. Система автоматично заповнює значення за позиціями з раніше відправленого документа "Підтвердження замовлення" (ORDRSP), на основі якого був створений документ "Повідомлення про відвантаження" (DESADV). Можливо вносити зміни в кількість і ціну позицій.

:red:`Всі зміни за позиціями варто виконувати тільки після узгодження з мережею!`

Зміни за позиціями можливо виконувати в табличній частині в колонках "Кількість, що постачається", "Ціна без ПДВ", "Ціна з ПДВ", "Ставка ПДВ" або за конкретною позицією, натиснувши на штрихкод позиції:

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_015.png
   :align: center

Якщо по якійсь з позицій не буде поставки її необхідно відзначити галочкою і **"Видалити"**.

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_018.png
   :align: center

.. important::
   **Увага!** У разі створення **кількох** видаткових накладних на замовлення, необхідно на кожну накладну формувати **Повідомлення про відвантаження**. При цьому, поле **"За накладною №"** в документах повинно відрізнятися.

.. attention::
   Кількість товарних позицій, що постачається не може перевищувати кількість зазначену в "Замовленні"!

Після внесення всіх даних в документ, натисніть кнопку **"Зберегти"** (1), потім **"Відправити"** (2).

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_016.png
   :align: center
   
Відправлений документ автоматично потрапляє в папку **"Надіслані"** і буде знаходитись в `ланцюжку документів <https://wiki.edin.ua/uk/latest/_constant/chain/chain.html>`__ разом із "Замовленням" і "Підтвердженням замовлення".

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_017.png
   :align: center

--------------------------------------------------------------------------------------------------

.. note::
   У відповідь на "Повідомлення про відвантаження" (DESADV) Мережа може створити та відправити "Повідомлення про прийом" (RECADV) для додаткового оповіщення про прийом товарів чи задля зазначеня розбіжностей між вказаним та фактично отриманим товаром.

3 Формування "Видаткової накладної" (DOCUMENTINVOICE.DocumentFunctionCode = DRN)
====================================================================================================================================

"Видаткова накладна" (DOCUMENTINVOICE.DocumentFunctionCode = DRN) може бути сформована на підставі "Повідомлення про відвантаження" (DESADV). Для формування "Видаткової накладної" (DOCUMENTINVOICE.DocumentFunctionCode = DRN) потрібно перейти в папку **"Надіслані"** та обрати документ-підставу (для зручності можливо скористатись `пошуком <https://wiki.edin.ua/uk/latest/general_2_0/rabota_s_platformoj_EDIN_2.0.html#doc-search>`__):

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_019.png
   :align: center

Для формування "Видаткової накладної" (DOCUMENTINVOICE.DocumentFunctionCode = DRN) натисніть **"Створити документ"** в блоці `ланцюжка документів <https://wiki.edin.ua/uk/latest/_constant/chain/chain.html>`__ "Товарна накладна"(DOCUMENTINVOICE).

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_020.png
   :align: center

При цьому для мережі "Укрнафта" автоматично створюється саме "Видаткова накладна" (DOCUMENTINVOICE.DocumentFunctionCode = DRN):

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_021.png
   :align: center

У відкритій формі "Видаткової накладної" (DOCUMENTINVOICE.DocumentFunctionCode = DRN) деякі поля заповнюються автоматично з пов'язаного документа-підстави (обов'язкові до заповнення поля позначені червоною зірочкою :red:`*`).

.. include:: /ClientProcesses/BOX_Market/BOX_Market_Instructions/BOX_Market_Standard.rst
   :start-after: .. початок блоку для ForAllDOCUMENTINVOICE
   :end-before: .. кінець блоку для ForAllDOCUMENTINVOICE

Про необхідність заповнення та інші помилки в табличній частині документа Ви будете проінформовані (вказується номер позиції та невідповідність), а також рядок позиції виділяється помаранчевим кольором:

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_022.png
   :align: center

Зміни за позиціями можливо виконувати в табличній частині в колонках "Код УКТ ЗЕД", "Кількість", "Ціна без ПДВ", "Ставка ПДВ" або за конкретною позицією, натиснувши на штрихкод позиції:

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_023.png
   :align: center

Якщо по якійсь з позицій не буде поставки її необхідно відзначити галочкою і **"Видалити"**.

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_024.png
   :align: center

Після внесення всіх необхідних змін в документ потрібно натиснути кнопку **"Зберегти"** (1), після чого можливо **"Підписати"** (2):

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_025.png
   :align: center

.. _sign:

3.1 Підписання та відправка "Видаткової накладної" (DOCUMENTINVOICE.DocumentFunctionCode = DRN)
--------------------------------------------------------------------------------------------------

.. tabs::

   .. tab:: Файловий ключ

      .. include:: /_constant/signing/signing.rst
         :start-after: .. початок блоку для Signing
         :end-before: .. кінець блоку для Signing

   .. tab:: Token

      .. include:: /_constant/token_signing/token_signing.rst
         :start-after: .. початок блоку для TokenSign
         :end-before: .. кінець блоку для TokenSign

   .. tab:: Гряда

      .. include:: /_constant/gryada_signing/gryada_signing.rst
         :start-after: .. початок блоку для GryadaSign
         :end-before: .. кінець блоку для GryadaSign

   .. tab:: Cloud

      .. include:: /_constant/cloud_signing/cloud_signing.rst
         :start-after: .. початок блоку для CloudSign
         :end-before: .. кінець блоку для CloudSign

Після підписання "Видаткової накладної" (DOCUMENTINVOICE.DocumentFunctionCode = DRN) документ потрібно **"Відправити"**:

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_026.png
   :align: center

Відправлений документ автоматично потрапляє в папку **"Надіслані"** і буде знаходитись в `ланцюжку документів <https://wiki.edin.ua/uk/latest/_constant/chain/chain.html>`__ разом із пов'язаними документами. Мережа "Укрнафта" зі своєї сторони переглядає та підписує документ.

4 Обробка вхідного документа "Акт невідповідності" (COMDOC_009)
====================================================================================================================================

У випадку розходження між відправленною і фактично прийнятою кількістю товару чи виникненням цінової розбіжності – мережа надсилає Вам "Акт невідповідності" (COMDOC_009). У вхідному документі в табличній частині будуть зазначені кількісні чи цінові розбіжності по кожному товару та причина невідповідності, наприклад:

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_027.png
   :align: center

.. image:: pics_UkrNafta_Standard/UkrNafta_Standard_028.png
   :align: center

Після ознайомлення з документом необхідно заново сформувати "Видаткову накладну" (DOCUMENTINVOICE.DocumentFunctionCode = DRN) на підставі раніше відправленого "Повідомлення про відвантаження" (DESADV) з правками кількості/ціни згідно розбіжностей вказаних в "Акті невідповідності" (COMDOC 009) мережі "Укрнафта".

------------------------------------------------

.. include:: /_constant/kontakti.rst
